# –ö–∞–∫ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ø—Ä–æ—Å—Ç–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

## –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –¥–µ–ø–ª–æ—è

### –°–ø–æ—Å–æ–± 1: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –∫–æ–¥)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –µ—Å–ª–∏:
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
cd /var/www/bf-news

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
git pull origin main

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è package.json)
pnpm install

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
pnpm build

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pnpm migrate

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 restart bf-news

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status
pm2 logs bf-news --lines 50
```

**–í—Ä–µ–º—è:** ~2-3 –º–∏–Ω—É—Ç—ã

### –°–ø–æ—Å–æ–± 2: –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –µ—Å–ª–∏:
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞
- –ù—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
cd /var/www/bf-news

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –±—ã–ª–∏ –Ω–æ–≤—ã–µ)
pnpm migrate

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 restart bf-news

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status
```

**–í—Ä–µ–º—è:** ~10 —Å–µ–∫—É–Ω–¥

## –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

–ö–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ CI/CD, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `deploy-production.sh`, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ù–æ –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–æ—Å–æ–± 1 –∏–ª–∏ 2 –≤—ã—à–µ.

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@–≤–∞—à-—Å–µ—Ä–≤–µ—Ä
```

### 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd /var/www/bf-news
```

### 3. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
git pull origin main
```

–ï—Å–ª–∏ Git –ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –∏–ª–∏ –∫–ª—é—á, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS —Å —Ç–æ–∫–µ–Ω–æ–º.

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è package.json –∏–ª–∏ pnpm-lock.yaml
pnpm install
```

### 5. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

```bash
pnpm build
```

–≠—Ç–æ –∑–∞–π–º—ë—Ç 1-2 –º–∏–Ω—É—Ç—ã. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

### 6. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
pnpm migrate
```

–≠—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### 7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
pm2 restart bf-news
```

### 8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 status

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
pm2 logs bf-news --lines 50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl
curl -I http://localhost:4000
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è `HTTP/1.1 200 OK`.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ: https://bfnews.ru

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–û—Ç–∫—Ä–æ–π—Ç–µ: https://bfnews.ru/admin

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
pm2 logs bf-news --lines 100
```

–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ (–∫—Ä–∞—Å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏).

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PM2

```bash
pm2 status
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `online` (–∑–µ–ª—ë–Ω—ã–π)

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot find module"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd /var/www/bf-news
pnpm install
pnpm build
pm2 restart bf-news
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Migration failed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–π
pnpm migrate

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
cd /var/www/bf-news
pnpm payload migrate
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs bf-news --err

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 4000 —Å–≤–æ–±–æ–¥–µ–Ω
netstat -tulpn | grep 4000

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
pm2 restart bf-news
```

### –ü—Ä–æ–±–ª–µ–º–∞: "504 Gateway Timeout"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
pm2 status

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
pm2 restart bf-news

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs bf-news
```

## –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

–°–æ–∑–¥–∞–π—Ç–µ –∞–ª–∏–∞—Å—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ (–¥–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc`):

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ ~/.bashrc:
alias bf-deploy='cd /var/www/bf-news && git pull && pnpm install && pnpm build && pnpm migrate && pm2 restart bf-news'
alias bf-logs='pm2 logs bf-news'
alias bf-status='pm2 status bf-news'
alias bf-restart='pm2 restart bf-news'
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
source ~/.bashrc
bf-deploy    # –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
bf-logs      # –õ–æ–≥–∏
bf-status    # –°—Ç–∞—Ç—É—Å
bf-restart   # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### –û–±—ã—á–Ω—ã–π –¥–µ–ø–ª–æ–π (–∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è –∫–æ–¥):

```bash
cd /var/www/bf-news
git pull origin main
pnpm install
pnpm build
pnpm migrate
pm2 restart bf-news
pm2 logs bf-news --lines 20
```

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å):

```bash
cd /var/www/bf-news
pm2 restart bf-news
pm2 logs bf-news --lines 50
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–π:

```bash
cd /var/www/bf-news
git pull origin main
pnpm migrate
pm2 restart bf-news
```

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

1. **git pull** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. **pnpm install** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. **pnpm build** ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç (—Å–æ–∑–¥–∞—ë—Ç `.next/standalone/server.js`)
4. **pnpm migrate** ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. **pm2 restart** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º

## –í—Ä–µ–º—è –¥–µ–ø–ª–æ—è

- **–ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π:** 2-3 –º–∏–Ω—É—Ç—ã (—Å–±–æ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
- **–¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:** 10 —Å–µ–∫—É–Ω–¥
- **–° –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:** 30 —Å–µ–∫—É–Ω–¥

## –†–µ–∑—é–º–µ

**–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**

```bash
cd /var/www/bf-news
git pull origin main
pnpm install && pnpm build && pnpm migrate && pm2 restart bf-news
```

**–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:**

```bash
pm2 restart bf-news
```

**–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```bash
pm2 status
pm2 logs bf-news --lines 50
```

–í—Å—ë –ø—Ä–æ—Å—Ç–æ! üöÄ

